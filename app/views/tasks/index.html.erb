<% Category.all.each do |cat| %>
  <h2><%= cat.name %> <%= "(#{cat.tasks.count})" %></h2>

  <table id="<%= cat.technical_name %>">
    <tbody class="tasks">
      <% Task.where(:category_id => cat.id).order("position ASC").each do |i| %>
        <tr id="task_<%= i.id %>" class="task">
          <td class="span2">
            <%= i.date.try(:strftime, "%d/%m/%Y") %>
          </td>
          <td class="span11">
            <%= i.name %>
          </td>
          <td class="span3 action">
            <%= link_to 'Edit', edit_task_path(i), :class => "btn" %>
            <%= button_to 'Delete', task_path(i), :confirm => 'Are you sure?', :method => :delete, :class => "btn danger" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
